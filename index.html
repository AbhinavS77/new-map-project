<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Collaborative LAN Map</title>
  <link rel="stylesheet" href="public/css/leaflet.css" />
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;font-family:Inter,system-ui,Arial;background:#f5f7fb;color:#111}
    #map { width:100%; height:100%; }
    .container { display:flex; height:100vh; overflow:hidden; }
    #sidebar { width:300px; background:#fff; padding:16px; box-shadow:2px 0 14px rgba(20,30,40,0.04); overflow:auto; }
    #map-container { flex:1; position:relative; }
    .btn{cursor:pointer;border:none;padding:8px 10px;border-radius:8px}
    #connection-modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.28);z-index:3000}
    .modal {background:#fff;padding:18px;border-radius:10px;width:420px;box-shadow:0 10px 40px rgba(0,0,0,0.08)}
    #server-panel{position:absolute;left:18px;top:64px;width:320px;background:#fff;padding:10px;border-radius:8px;box-shadow:0 8px 30px rgba(0,0,0,0.06);display:none;z-index:1100}
    #server-btn{position:absolute;left:18px;top:18px;display:none;padding:8px;background:#fff;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.06);z-index:1100}
    #floating-buttons{position:absolute;right:18px;top:18px;display:flex;flex-direction:column;gap:8px;z-index:1000}
    #status-popup{position:fixed;left:50%;transform:translateX(-50%);bottom:20px;background:#111;color:#fff;padding:8px 12px;border-radius:18px;opacity:0;transition:opacity .2s}
    #status-popup.show{opacity:1}
    #pinned-locations{list-style:none;padding:0;display:flex;flex-direction:column;gap:8px}
    #pinned-locations li{background:#fcfcff;padding:10px;border-radius:8px;border:1px solid #eef2f7}

    /* overlays controls styling */
    .overlays-controls { margin-bottom:14px; padding:10px; border-radius:8px; background:#fff; border:1px solid #eef2f7; }
    .overlays-controls h3 { margin-bottom:8px; font-size:16px; }
    .overlays-row { display:flex; gap:8px; align-items:center; margin-bottom:8px; }
    .overlays-row input[type="text"] { flex:1; padding:8px; border-radius:8px; border:1px solid #e6e9ef; font-size:13px; }
    .overlays-row .small { width:120px; }
    .overlays-pin { background:#1e88e5; color:#fff; padding:8px 10px; border-radius:8px; cursor:pointer; border:none }
    .overlays-help { font-size:12px; color:#6b7280; margin-top:6px; }
  </style>
</head>
<body>
  <div id="connection-modal">
    <div class="modal">
      <h3>Start or Join a Session</h3>
      <div style="margin-top:10px;color:#475569">If exactly one host is on your LAN, the app will auto-connect. Otherwise enter Host IP or start hosting.</div>

      <div style="margin-top:12px;">
        <input id="ip-address-input" placeholder="Host IP (leave blank for discovery)" style="width:100%;padding:8px;border-radius:8px;border:1px solid #e6e9ef" />
      </div>

      <div style="margin-top:8px;">
        <input id="client-name-input" placeholder="Your Name (required to join)" style="width:100%;padding:8px;border-radius:8px;border:1px solid #e6e9ef" />
      </div>

      <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
        <label>Pin Color</label>
        <input type="color" id="pin-color-input" value="#ff4d4f"/>
        <label style="margin-left:8px">User Dot</label>
        <input type="color" id="user-dot-color-input" value="#1e88e5"/>
      </div>

      <div style="display:flex;gap:8px;margin-top:12px;">
        <button id="host-btn" class="btn" style="background:#1e88e5;color:#fff">Host Session</button>
        <button id="client-btn" class="btn" style="background:#10b981;color:#fff">Join Session</button>
      </div>
    </div>
  </div>

  <div class="container" id="main-container" style="display:none;">
    <div id="sidebar">
      <h2>Pinned Locations</h2>

      <!-- OVERLAYS CONTROLS (Lat/Lon + Pin button) -->
      <div id="overlays-container" class="overlays-controls">
        <h3>Overlays</h3>

        <!-- Lat / Long row -->
        <div class="overlays-row">
          <input id="overlay-lat-input" class="small" type="text" placeholder="Latitude (e.g. 28.6139)" />
          <input id="overlay-lon-input" class="small" type="text" placeholder="Longitude (e.g. 77.2090)" />
          <button id="overlay-pin-btn" class="overlays-pin">Pin</button>
        </div>

        <div class="overlays-help">Enter lat &amp; long, then click <strong>Pin</strong> to center the map on that coordinate.</div>

        <div id="overlays-list" style="margin-top:12px"></div>
      </div>
      <!-- END OVERLAYS CONTROLS -->

      <ul id="pinned-locations"></ul>
    </div>

    <div id="map-container">
      <div id="map"></div>

      <div id="floating-buttons">
        <button id="user-toggle-btn" class="btn">User Mode OFF</button>
        <button id="pin-toggle-btn" class="btn">Pin Mode OFF</button>

        <!-- Added RF and Radar buttons above Clear All as requested -->
        <button id="rf-toggle-btn" class="btn">RF Mode OFF</button>
        <button id="radar-toggle-btn" class="btn">Radar Mode OFF</button>

        <!-- ADDED: Generate Pin button (same .btn style as others). -->
        <button id="generate-ID-btn" class="btn">Genreate Id</button>

        <button id="chat-btn" class="btn">Chat</button>

        <button id="clear-btn" class="btn" style="background:#ef4444;color:#fff">Clear All</button>
      </div>

      <button id="server-btn">Server</button>
      <div id="server-panel"></div>
      <div id="status-popup"></div>
    </div>
  </div>

  <script src="public/js/leaflet.js"></script>
  <script src="public/js/socket.io.min.js"></script>
  <script src="map.js"></script>

  <!-- Put this near the end of body (e.g. just before </body>) -->
  <div id="chat-modal" style="display:none;position:fixed;right:18px;bottom:18px;width:360px;max-height:70vh;background:#fff;border-radius:10px;box-shadow:0 10px 40px rgba(0,0,0,0.12);z-index:4000;overflow:hidden;display:flex;flex-direction:column;">
    <div style="display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid #eef2f7;">
      <div style="font-weight:700">Session Chat</div>
      <button id="chat-close-btn" class="btn" style="padding:6px 8px">âœ•</button>
    </div>
    <div id="chat-messages" style="padding:8px;overflow:auto;flex:1;background:#fbfcff"></div>
    <div style="padding:8px;border-top:1px solid #eef2f7;display:flex;gap:8px;align-items:center;">
      <input id="chat-input" placeholder="Type a message and press Enter" style="flex:1;padding:8px;border-radius:8px;border:1px solid #e6e9ef" />
      <button id="chat-send" class="btn" style="background:#1e88e5;color:#fff;padding:8px 10px;border-radius:8px">Send</button>
    </div>
  </div>
</body>
</html>
